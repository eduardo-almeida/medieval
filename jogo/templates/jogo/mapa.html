<!doctype html>
<html>
  <head>
    <title>Mapa - The West Clone</title>
    <style>
      .mapa-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        background: #2c2114;
        padding: 20px;
      }
      .local-card {
        border: 2px solid #5e432a;
        background: #3d2b1f;
        color: #e3c18b;
        padding: 15px;
        width: 200px;
        text-align: center;
      }
      .btn-viajar {
        background: #8b5a2b;
        color: white;
        border: none;
        padding: 8px;
        cursor: pointer;
        width: 100%;
      }
      .btn-viajar:disabled {
        background: #555;
      }
    </style>
  </head>
  <body>
    <h1>Mapa do Velho Oeste</h1>
    <p>
      Posição Atual: (<span id="pos-x">{{ personagem.posicao_x }}</span>,
      <span id="pos-y">{{ personagem.posicao_y }}</span>)
    </p>

    <div class="mapa-container">
      {% for local in locais %}
      <div class="local-card">
        <h3>{{ local.nome }}</h3>
        <p>Coordenadas: {{ local.posicao_x }}, {{ local.posicao_y }}</p>
        <button
          class="btn-viajar"
          onclick="viajar('{{ local.id }}')"
          {%
          if
          personagem.esta_ocupado
          %}disabled{%
          endif
          %}
        >
          Viajar para aqui
        </button>
      </div>
      {% endfor %}
    </div>

    <script>
      function viajar(localId) {
        fetch("/viajar/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token }}",
          },
          body: JSON.stringify({ local_id: localId }),
        }).then((response) => {
          if (response.ok) {
            alert("Viagem iniciada!");
            window.location.reload(); // Recarrega para mostrar o status de ocupado
          } else {
            alert("Não podes viajar agora.");
          }
        });
      }
    </script>
  </body>
</html>
